<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="http://www.yoursite.com/favicon.ico?v=2" type="image/x-icon">
    <link rel="stylesheet" href="/css/schedule.css" />

    <!-- Full calendar 라이브러리 추가 -->
    <!-- 화면 해상도에 따라 글자 크기 대응(모바일 대응) -->
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    
    <!-- jquery CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- fullcalendar CDN -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/main.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/main.min.js'></script>

    <!-- fullcalendar 언어 CDN -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/locales-all.min.js'></script>

    <!-- axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- 부트스트랩CDN -->
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous">
    </script>

    <title>스케쥴</title>

    <style>
        /* body 스타일 */
        html, body {
            overflow: hidden;
            font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
        }
        /* 캘린더 위의 해더 스타일(날짜가 있는 부분) */
        .fc-header-toolbar {
            padding-top: 1em;
            padding-left: 1em;
            padding-right: 1em;
        }
    </style>

    <script type="text/javascript" id = "Clock">
        function showClock(){
            var currentDate = new Date();
            var divClock = document.getElementById('divClock');
            var msg = "";

            if(currentDate.getHours() > 12){  //시간이 12보다 크다면 오후 아니면 오전
                msg += "P.M ";
                msg += currentDate.getHours()-12+" : ";
            }
            else {
                msg += "A.M ";
                msg += currentDate.getHours()+" : ";
            }

            if(currentDate.getMinutes() < 10){
                msg += "0" + currentDate.getMinutes() + " ";
            }
            else {
                msg += currentDate.getMinutes() + " ";
            }
            
            week = currentDate.getDay()
            if(week == 0) msg += "(일)";
            else if(week == 1) msg += "(월)";
            else if(week == 2) msg += "(화)";
            else if(week == 3) msg += "(수)";
            else if(week == 4) msg += "(목)";
            else if(week == 5) msg += "(금)";
            else if(week == 6) msg += "(토)";
            
            divClock.innerText = msg;

            setTimeout(showClock,1000);  //1초마다 갱신
        }

        // 서브 창 표시 여부를 토글하는 함수
        function toggleSubWindow() {
            var subWindow = document.querySelector('.sub-window');
            subWindow.style.display = subWindow.style.display === 'none' ? 'block' : 'none';
        }

        (function(){
            $(function(){

            // calendar element 취득
            var calendarEl = $('#calendar')[0];

            // full-calendar 생성하기
            var calendar = new FullCalendar.Calendar(calendarEl, {
                //googleCalendarApiKey: '', // 여기에 구글캘린더 api키 입력하시면 됩니다.
                height: '700px',        // calendar 높이 설정
                expandRows: true,       // 화면에 맞게 높이 재설정
                slotMinTime: '08:00',   // Day 캘린더에서 시작 시간
                slotMaxTime: '20:00',   // Day 캘린더에서 종료 시간
                customButtons:{
                    myCustomButton:{
                        text:"일정 추가하기",
                        click : function(){
                            //부트스트랩 모달 열기
                            $("#exampleModal").modal("show");              
                        }
                    },
                    mySaveButton:{
                        text:"저장하기",
                        click: async function () {
                            if (confirm("저장하시겠습니까?")) {
                                //지금까지 생성된 모든 이벤트 저장하기
                                var allEvent = calendar.getEvents();
                                console.log("모든 이벤트들", allEvent);
                                
                                //이벤트 저장하기
                                const saveEvent = await axios({
                                method: "POST",
                                url: "/calendar",
                                data: allEvent,
                                });
                            }
                        },
                    }
                },
                // 해더에 표시할 툴바
                headerToolbar: {
                    left: 'prev,next today,myCustomButton,mySaveButton',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
                },

                initialView: 'dayGridMonth',    // 초기 로드 될때 보이는 캘린더 화면(기본 설정: 달)
                // initialDate: '2021-07-15',   // 초기 날짜 설정 (설정하지 않으면 오늘 날짜가 보인다.)
                navLinks: true,     // 날짜를 선택하면 Day 캘린더나 Week 캘린더로 링크
                editable: true,     // 수정 가능?
                selectable: true,   // 달력 일자 드래그 설정가능
                nowIndicator: true, // 현재 시간 마크
                dayMaxEvents: true, // 이벤트가 오버되면 높이 제한 (+ 몇 개식으로 표현)
                locale: 'ko',       // 한국어 설정
                eventAdd: function(obj) {       // 이벤트가 추가되면 발생하는 이벤트
                    console.log(obj);
                },
                eventChange: function(obj) {    // 이벤트가 수정되면 발생하는 이벤트
                    console.log(obj);
                },
                eventRemove: function(obj){     // 이벤트가 삭제되면 발생하는 이벤트
                    console.log(obj);
                },
                select: function(arg) {         // 캘린더에서 드래그로 이벤트를 생성할 수 있다.
                    var title = prompt('Event Title:');
                    if (title) {
                        calendar.addEvent({
                        title: title,
                        start: arg.start,
                        end: arg.end,
                        allDay: arg.allDay
                        })
                    }
                    calendar.unselect()
                },
                //데이터 가져오는 이벤트
                eventSources:[
                {
                    events: async function (info, successCallback, failureCallback) {
                        const eventResult = await axios({
                            method: "POST",
                            url: "/eventData",
                        });
                        const eventData = eventResult.data;

                        //이벤트에 넣을 배열 선언하기
                        const eventArray = [];
                        eventData.forEach((res) => {
                            eventArray.push({
                                title: res.title,
                                start: res.start,
                                end: res.end,
                                backgroundColor: res.backgroundColor,
                            });
                        });
                        successCallback(eventArray);
                    },
                },
                {
                    googleCalendarId : 'ko.south_korea.official#holiday@group.v.calendar.google.com',
                    backgroundColor: 'red',
                }
                ]
            });

            //모달창 이벤트
            $("#saveChanges").on("click", function () {
                var eventData = {
                    title: $("#title").val(),
                    start: $("#start").val(),
                    end: $("#end").val(),
                    color: $("#color").val(),
                };

                // 데이터 전송
                $.ajax({
                    url: '/saveSchedule',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify([eventData]),
                    
                    success: function(response) {
                        console.log(response);
                    },
                    error: function(error) {
                        console.error(error);
                    }
                });

                //빈값입력시 오류
                if (
                    eventData.title == "" ||
                    eventData.start == "" ||
                    eventData.end == ""
                ) {
                alert("입력하지 않은 값이 있습니다.");

                //끝나는 날짜가 시작하는 날짜보다 값이 크면 안됨
                } else if ($("#start").val() > $("#end").val()) {
                    alert("시간을 잘못입력 하셨습니다.");
                } else {
                    // 이벤트 추가
                    calendar.addEvent(eventData);
                    $("#exampleModal").modal("hide");
                    $("#title").val("");
                    $("#start").val("");
                    $("#end").val("");
                    $("#color").val("");
                }
            });

            // 캘린더 랜더링
            calendar.render();
            });
        })
    ();
    </script>
</head>

<body onload="showClock()">
    <div style="display: flex; width: 100%;">
        <div class="nav_wrap" style="width: 240px;">

            <div class = "id" style="width: 208px;"></div>

            <div class = "FREE_TRIAL nav_table">
                <a href="home.html">
                    <div class = "menu_home" style="display: flex; flex-direction: column; border-radius: 15px;">
                        
                        <!-- 홈 -->
                        <div style="display: flex; -webkit-box-align: center; align-items: center; gap: 6px;">
                            <div><img src="src/home_img.png" alt="홈 이미지"></div>
                            <div class="home_font">
                                <span>홈</span>
                            </div>
                        </div>
                    </div>
                </a>


                <!-- 구분선 -->
                <div style="height: 1px; border-top: 1px solid rgb(0, 0, 0); width: 100%; margin-block: 12px;"></div>


                <div style="padding: 0rem; height: auto; background-color: rgb(255, 255, 255);">
                    <!-- 출퇴근 및 방문 메뉴 부분-->
                    <div style="margin-bottom: 12px;">
                        <div class="index">
                            <span>출퇴근 및 방문</span>
                            <div><img src="src/menu_down.png" alt="메뉴 자세히 보기"></div>
                        </div>

                        <div>
                            <!--
                            # 출퇴근
                            <div style="display: flex; flex-direction: column; border-radius: 6px;">
                                <div class="nav-menu-item" style="padding-block: 6px; border-radius: 6px;">
                                    <div>
                                        <div><img src="src/work_time.png" alt="출퇴근 이미지"></div>
                                        <div><span>출퇴근</span></div>
                                    </div>
                                </div>
                            </div>
                            -->

                            <!-- 스케쥴 -->
                            <div style="display: flex; flex-direction: column; border-radius: 6px;">
                                <div class="nav-menu-item" style="padding-block: 6px; border-radius: 6px;">
                                    <div>
                                        <div><img src="src/schedule.png" alt="스케쥴 이미지"></div>
                                        <div><span>스케줄</span></div>
                                    </div>
                                    <div>
                                        <div><img src="src/detail_down.png" alt="스케쥴 메뉴 열기"></div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- 커뮤니케이션 메뉴 부분 -->
                    <div style="margin-bottom: 12px;">
                        <div class="index">
                            <span>커뮤니케이션</span>
                            <div><img src="src/menu_down.png" alt="메뉴 자세히 보기"></div>
                        </div>

                        
                        <div>
                            <!-- 할 일 -->
                            <div style="display: flex; flex-direction: column; border-radius: 6px;">
                                <div class="nav-menu-item" style="padding-block: 6px; border-radius: 6px;">
                                    <div>
                                        <div><img src="src/to_do.png" alt="할 일 이미지"></div>
                                        <div><span>할 일</span></div>
                                    </div>
                                </div>
                            </div>

                            <!-- 공지 및 설문 -->
                            <div style="display: flex; flex-direction: column; border-radius: 6px;">
                                <div class="nav-menu-item" style="padding-block: 6px; border-radius: 6px;">
                                    <div>
                                        <div><img src="src/notification.png" alt="공지 및 설문 이미지"></div>
                                        <div><span>공지 및 설문</span></div>
                                    </div>
                                </div>
                            </div>

                            <!-- 보고서 
                            <div style="display: flex; flex-direction: column; border-radius: 6px;">
                                <div class="nav-menu-item" style="padding-block: 6px; border-radius: 6px;">
                                    <div>
                                        <div><img src="src/report.png" alt="보고서 이미지"></div>
                                        <div><span>보고서</span></div>
                                    </div>
                                    <div>
                                        <div><img src="src/detail_down.png" alt="보고서 메뉴 열기"></div>
                                    </div>
                                </div>
                            </div>
                            -->

                            <!-- 게시판 -->
                            <div style="display: flex; flex-direction: column; border-radius: 6px;">
                                <div class="nav-menu-item" style="padding-block: 6px; border-radius: 6px;">
                                    <div>
                                        <div><img src="src/notice board.png" alt="게시판 이미지">
                                        </div>
                                        <div><span>게시판</span></div>
                                    </div>
                                    <div>
                                        <div><img src="src/detail_down.png" alt="게시판 메뉴 열기"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- 채팅 -->
                            <div style="display: flex; flex-direction: column; border-radius: 6px;">
                                <div class="nav-menu-item" style="padding-block: 6px; border-radius: 6px;">
                                    <div>
                                        <div><img src="src/chat.png" alt="채팅 이미지"></div>
                                        <div><span>채팅</span></div>
                                    </div>
                                    <div><img src="src/entering.png" alt="채팅 진입"></div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- 구분선 -->
                    <div style="height: 1px; border-top: 1px solid rgb(0, 0, 0); width: 100%; margin-block: 12px;"></div>

                    <!-- 기타 메뉴 부분 -->
                    <div>
                        <!-- 설정 -->
                        <div style="display: flex; flex-direction: column; border-radius: 6px;">
                            <div class="nav-menu-item" style="padding-block: 6px; border-radius: 6px;">
                                <div>
                                    <div><img src="src/setting.png" alt="설정 이미지">
                                    </div>
                                    <div><span>설정</span></div>
                                </div>
                            </div>
                        </div>

                        <!-- 결제 -->
                        <div style="display: flex; flex-direction: column; border-radius: 6px;">
                            <div class="nav-menu-item" style="padding-block: 6px; border-radius: 6px;">
                                <div>
                                    <div><img src="src/pay.png" alt="결제 이미지"></div>
                                    <div><span>결제</span></div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div style="min-width: 240px;"></div>

        <div class="header">
            <div class = "selected_menu">Schedule</div>
            <div style="margin-left: 12px;">
                <button class = "setting"  onclick="toggleSubWindow()">
                    <div>
                        <img class="user_avatar" src="src/user.png" alt="avatar image">
                    </div>
                </button>

                <!-- 서브 창 -->
                <div class="sub-window">
                    <ul>
                        <a href="profile.html" style="text-decoration: none; color:black">
                            <li><span>프로필</span></li>
                        </a>
                        <a href="/auth/logout" style="text-decoration: none; color:black">
                            <li><span>로그아웃</span></li>
                        </a>
                    </ul>
                </div>
            </div>
        </div>


        <div class = "main">
            <div class="main_wrap">
                <div id="divClock" style="font-size: 25px; font-weight: 700;"></div>


                <!-- calendar 태그 -->
        <div id='calendar-container'>
            <div id='calendar'></div>
        </div>
            <!-- 부트스트랩 modal 부분 -->
            <!-- Modal -->
            <div class="modal fade show" id="exampleModal"
            tabindex="-1" aria-labelledby="exampleModalLabel"
            aria-hidden="true" role="dialog" aria-hidden="true" 
            style="display: block;">   
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">일정 추가하기</h5>
                            <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                            ></button>
                        </div>
                        <div class="modal-body">
                            일정이름 : <input type="text" id="title" /><br />
                            시작시간 : <input type="datetime-local" id="start" /><br />
                            종료시간 : <input type="datetime-local" id="end" /><br />
                            배경색상 :
                            <select id="color">
                            <option value="red">빨강색</option>
                            <option value="orange">주황색</option>
                            <option value="yellow">노랑색</option>
                            <option value="green">초록색</option>
                            <option value="blue">파랑색</option>
                            <option value="indigo">남색</option>
                            <option value="purple">보라색</option>
                            </select>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                취소
                            </button>
                            <button type="button" class="btn btn-primary" id="saveChanges">
                                추가
                            </button>
                        </div>
                    </div>
                </div>
            </div>

                <!--
                <div>
                    <section>
                        <div>
                            <div>
                                <div><img src="src/schedule_color.png" alt="스케쥴 컬러 이미지"></div>
                                <h6>오늘 스케줄</h6>
                            </div>
                            <div>
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="css-125q558">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M5.27036 15.7326C4.94265 15.4084 4.91286 14.9012 5.18099 14.5437L5.27036 14.4413L10.7711 9L5.27036 3.55866C4.94265 3.23451 4.91286 2.72727 5.18099 2.36983L5.27036 2.26743C5.59808 1.94327 6.11089 1.91381 6.47226 2.17902L6.57579 2.26743L12.7296 8.35438C13.0574 8.67853 13.0871 9.18577 12.819 9.54321L12.7296 9.64562L6.57579 15.7326C6.21531 16.0891 5.63085 16.0891 5.27036 15.7326Z" fill="#333333">
                                    </path>
                                </svg>
                            </div>
                        </div>
                        
                    </section>
                </div>
                -->
            </div>
        </div>
    </div>
</body>
</html>